/*!
 * WillJS JavaScript Library v1.1
 * http://github.com/kawamanza/will.js
 *
 * Copyright 2011, Marcelo Manzan
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Date: Sun Dec 04 03:27:11 2011 -0200
 */
(function(m,A,j){function v(a,b){this.name=a;b&&r(this,false)}function n(a){return typeof a==="string"}function s(a){return J.call(a)==="[object Array]"}function o(a){return typeof a!=="object"}function p(a){return typeof a==="function"}function B(a,b,c){var d,e;n(b)&&(b=b.split(/\./));d=b.shift();if(b.length==0)a[d]=c;else{e=a[d];if(o(e)||s(e))e={},a[d]=e;B(e,b,c)}}function k(a,b){var c="",d;n(a)&&(c=a+".",a=b);for(d in a)B(this,c+d,a[d]);return this}function t(a){var b=j,c;n(a)?(a=a.split(/[\?#]/)[0],
/^([\w\-\.]+)\@(.+)$/.test(a)?b=[RegExp.$1,RegExp.$2]:(c=a.split(/\//),c=c[c.length-1],b=[K.test(c)?RegExp.$1:c,a],/\.css$/.test(b[1])&&(c=b[1].split(/\/+/),/^\^?(\w+:|)$/.test(c[0])&&c.shift(),c.pop(),c.push(b[0]),b[0]=c.join("_").replace(/:/,"-")))):(c=a.getAttribute("src")||a.getAttribute("href"),b=[a.getAttribute(C),(c||"").split(/[\?#]/)[0]],!b[0]&&b[1]&&(b=t(b[1])));b.length==2&&(b.push(/\.css$/.test(b[1])),b.push(b[2]?"link":"script"),b.push(/^\^/.test(b[1])),b[4]&&(b[1]=b[1].substr(1)));return b}
function L(a){var b=t(a),c=b[0],d=b[1],e=b[2],b=u.getElementsByTagName(b[3]),f,g=b.length,h;for(f=0;f<g;)if(h=b[f++],t(h)[0]===c)return/\@/.test(a)&&e&&h.getAttribute("href")!=d&&h.setAttribute("href",d),true;return false}function M(a,b,c){var d=false;a.onload=a.onreadystatechange=function(){var b=this.readyState;if(!d&&(!b||b==="loaded"||b==="complete"))d=true,c("success"),a.onload=a.onreadystatechange=j,a.onerror=a.onabort=j};a.onerror=a.onabort=function(){d=true;c("error");a.onload=a.onreadystatechange=
j;a.onerror=a.onabort=j;b&&a.parentNode&&b.removeChild(a)}}function N(a,b,c,d){var e=u.getElementsByTagName("head")[0]||u.documentElement,b=t(b),f=b[2],g=a.cfg.queryString,a=u.createElement(b[3]);a.setAttribute(C,b[0]);f&&a.setAttribute("rel","stylesheet");a[f?"href":"src"]=b[1]+(g?"?"+g:"");f||M(a,e,d);b[4]&&e.firstChild?e.insertBefore(a,c||e.firstChild):e.appendChild(a);f&&d("success",a)}function D(a,b,c){var d=a.cfg.mode===l.modes.PROD,e=a.cfg.queryString,f=false,g=m.location,h=a.cfg.debug,a=/^(\w+:)?\/\/([^\/]+)/.test(b)&&
(RegExp.$2!=g.host||RegExp.$1&&RegExp.$1!=g.protocol);e&&(d=true,b=b+"?"+e);m.jQuery.ajax({dataType:a?"jsonp":"html",success:function(a){f||(f=true,h&&h(" * successful loaded "+b),c(200,a))},complete:function(a){f||(f=true,h&&h(" * completed "+b),c(a.status,a.responseText))},cache:d,url:b})}function q(a){return{queue:[],active:false,run:a,sched:function(){var a=this;setTimeout(function(){a.process()},2)},process:function(a){var c=this,d=c.queue;if(arguments.length){if(o(a)||!s(a))a=[a];d.push(a);
setTimeout(function(){if(d.length&&!c.active)c.active=true,c.process()},5)}else if(d.length){a=d.shift();try{c.run.apply(c,a)!==false&&c.sched()}catch(e){throw c.sched(),e;}}else c.active=false}}}function r(a,b,c){if(b||!("cfg"in a))k.call(a,l.u.getConfig()),"call"in a||k.call(a,i);p(c)&&c(a.cfg)}function E(a,b){var c=b.packageName,d=b.domainName,d=a[d]||(a[d]={}),c=d[c]||(d[c]={}),d=b.name;return c[d]||(c[d]={rescue:function(){}})}function w(a,b,c){var d=function(){return c.apply(a,arguments)},e=
"impl";n(c)&&(e=c,c=b[e]);b[e]=function(){var f=arguments,g=b.assets||b.libs;if(g&&g.length)x(a,"loadDependenciesAndCall",[a,b,f]);else return b[e]=e=="impl"?d:c,b[e].apply(b,f)}}function y(a,b,c,d){if(!o(c)){var e=c.impl||p(c.getImpl)&&c.getImpl(a),f=c.assets||c.libs;if(p(e))b=E(b,d),b.assets=o(f)||!s(f)?[]:f,w(a,b,e),b.rescue=c.rescue||b.rescue;else for(e in c)d.name=e,y(a,b,c[e],d)}}function z(a,b,c){var a=a.cfg,d=a.domains,e="local",f=a.defaultPackage,g=b.toString();if(/^(?:(\w+):)?(?:(\w+)\.)?(\w+)$/.test(g))g=
RegExp.$3,f=RegExp.$2||a.packages[g]||f,e=RegExp.$1||e;d[e]||(e="local");return{format:c||d[e][0],domain:d[e][1],domainName:e,packageName:f,name:g,toString:function(){return e+":"+f+"."+g}}}function F(a,b,c){var a=a.cfg,d=b.packageName,e=b.name;if(c==j)c=a.mode;return b.domain+(c==l.modes.PROD?d:d==a.defaultPackage?e:d+"/"+e)+"."+b.format}function x(a,b,c){var a=a.cfg.processors,d=a[b];d||(d=a[b]=q(function(a){p(a)&&a()}));d.process(c)}function O(a,b){return function(){var c=arguments,d=z(a,b);x(a,
"callComponent",[a,d,c])}}function G(a,b){var c={assets:b};return function(b){if(!c.impl){var e,f;p(b)?(e=function(){b("success")},f=function(){b("error")}):e=f=function(){};w(a,c,e);c.rescue=f;c.impl()}}}var l,i={},C="data-willjs-id",K=/^([\w\-\.]+?)(?:\.min|\-\d+(?:\.\d+)*(?:\w+)?)*\.(?:css|js)$/,H=Array.prototype.slice,J=Object.prototype.toString,I=false,u=m.document;m[A]=l=new v(A);k.call(i,{call:function(a){return O(this,a)},use:function(a){return G(this,s(a)?a:H.call(arguments,0))},addComponent:function(a,
b){return y(this,this.registry,b,z(this,a))},addProcessor:function(a,b){this.cfg.processors[a]||(this.cfg.processors[a]=q(b))},process:function(a){x(this,a,H.call(arguments,1))},modes:{DEV:0,PROD:1},"u.extend":k,as:function(a){return!a?a:m[a]||(m[a]=new v(a,true))},configure:function(a){r(this,false,a);return this},reconfigure:function(a){r(this,true,a);return this}});k.call(v.prototype,i);i.u.loadComponent=function(a,b,c){I?c(500,""):a.use("//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js")(function(d){d===
"success"?(i.u.loadComponent=D,D(a,b,c)):(I=true,c(500,""))})};i.u.extend({pathFor:z,urlFor:F,implWrapper:w,newProcessor:q,getConfig:function(){return{cfg:k.call(new this.Defaults,{processors:new this.Processors,domains:{local:["json","/javascripts/will/"]},packages:{}}),registry:{}}},Processors:function(){},Defaults:function(){}});(function(a){a.callComponent=q(function(a,c,d){var e=this,f=a.registry,g=F(a,c),h=E(f,c),i=h.impl;if(i)i.apply(j,d);else return c.format=="js"?(g=c.toString().replace(/[:\.]/g,
"_")+"@"+g,G(a,[g])(function(a){try{if(a=="success")(i=h.impl)&&i.apply(j,d)}finally{e.sched()}})):l.u.loadComponent(a,g,function(g,k){try{if(g!==200)throw"could not load component: "+c;n(k)&&(k=eval("("+k+")"));if(!o(k))y(a,f,k,c),(i=h.impl)&&i.apply(j,d)}finally{e.sched()}}),false});a.loadDependenciesAndCall=q(function(a,c,d){var e=this,f=a.cfg.debug,g=c.assets||c.libs,h;if(g.length)if(h=g[0],L(h))g.shift(),c.impl.apply(j,d);else return f&&f('** loading asset "'+h+'"'),N(a,h,c.lastCss,function(a,
b){try{if(a==="success"){g.shift();if(b)c.lastCss=b;c.impl.apply(j,d)}else c.rescue.apply(j,d)}finally{e.sched()}}),false;else c.impl.apply(j,d)})})(i.u.Processors.prototype);k.call(i.u.Defaults.prototype,{mode:l.modes.DEV,version:"1.1",addDomain:function(a,b,c){this.domains[a]=[c?"js":"json",b+(/\/$/.test(b)?"":"/")]},defaultPackage:"root",registerPackage:function(a,b){var c=b.split(/,/),d,e,f;d=this.packages;for(f=0,e=c.length;f<e;)d[c[f++]]=a}});r(l,false)})(window,"will",null);
