/*!
 * Will.js JavaScript Library v1.0
 * http://github.com/kawamanza/will.js
 *
 * Copyright 2011, Marcelo Manzan
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Date: Wed Nov 30 00:00:00 2011 -0200
 */
(function(s,h){function o(a){return typeof a==="string"}function p(a){return G.call(a)==="[object Array]"}function l(a){return typeof a!=="object"}function m(a){return typeof a==="function"}function y(a,b,c){var d,e;o(b)&&(b=b.split(/\./));d=b.shift();if(b.length==0)a[d]=c;else{e=a[d];if(l(e)||p(e))e={},a[d]=e;y(e,b,c)}}function k(a,b){var c="",d;o(a)&&(c=a+".",a=b);for(d in a)y(this,c+d,a[d]);return this}function q(a){var b=h;o(a)?(a=a.split(/[\?#]/)[0],/^([\w\-\.]+)\@(.+)$/.test(a)?b=[RegExp.$1,
RegExp.$2]:(b=a.split(/\//),b=b[b.length-1],b=[H.test(b)?RegExp.$1:b,a])):(b=a.getAttribute("src")||a.getAttribute("href"),b=[a.getAttribute(z),(b||"").split(/[\?#]/)[0]],!b[0]&&b[1]&&(b=q(b[1])));b.length==2&&(b.push(/\.css$/.test(b[1])),b.push(b[2]?"link":"script"));return b}function I(a){var b=q(a),c=b[0],d=b[1],e=b[2],b=r.getElementsByTagName(b[3]),f,g=b.length,h;for(f=0;f<g;)if(h=b[f++],q(h)[0]===c)return/\@/.test(a)&&e&&h.getAttribute("href")!=d&&h.setAttribute("href",d),true;return false}function J(a,
b,c){var d=false;a.onload=a.onreadystatechange=function(){var b=this.readyState;if(!d&&(!b||b==="loaded"||b==="complete"))d=true,c("success"),a.onload=a.onreadystatechange=h,a.onerror=a.onabort=h};a.onerror=a.onabort=function(){d=true;c("error");a.onload=a.onreadystatechange=h;a.onerror=a.onabort=h;b&&a.parentNode&&b.removeChild(a)}}function K(a,b){var c=r.getElementsByTagName("head")[0]||r.documentElement,d=q(a),e=d[2],f;f=r.createElement(d[3]);f.setAttribute(z,d[0]);e&&f.setAttribute("rel","stylesheet");
f[e?"href":"src"]=d[1];e||J(f,c,b);c.appendChild(f);e&&b("success")}function A(a,b,c){var d=a.cfg.mode===j.modes.PROD;if(a=a.cfg.ajaxSuffix)d=true,b=b+"?"+a;s.jQuery.ajax({dataType:"html",complete:function(a){c(a.status,a.responseText)},cache:d,url:b})}function n(a){return{queue:[],active:false,run:a,sched:function(){var a=this;setTimeout(function(){a.process()},2)},process:function(a){var c=this,d=c.queue;if(arguments.length){if(l(a)||!p(a))a=[a];d.push(a);setTimeout(function(){if(d.length&&!c.active)c.active=
true,c.process()},5)}else if(d.length){a=d.shift();try{c.run.apply(c,a)!==false&&c.sched()}catch(e){throw c.sched(),e;}}else c.active=false}}}function t(a,b,c){if(b||!("cfg"in a))k.call(a,a.u.getConfig()),"call"in a||k.call(a,i);m(c)&&c(a.cfg)}function B(a,b){var c=b.packageName,c=a[c]||(a[c]={}),d=b.name;return c[d]||(c[d]={rescue:function(){}})}function u(a,b,c){var d=function(){return c.apply(a,arguments)},e="impl";o(c)&&(e=c,c=b[e]);b[e]=function(){var f=arguments,g=b.assets||b.libs;if(g&&g.length)v(a,
"loadDependenciesAndCall",[a,b,f]);else return b[e]=e=="impl"?d:c,b[e].apply(b,f)}}function w(a,b,c,d){if(!l(c)){var e=c.impl||m(c.getImpl)&&c.getImpl(a),f=c.assets||c.libs;if(m(e))b=B(b,d),b.assets=l(f)||!p(f)?[]:f,u(a,b,e),b.rescue=c.rescue||b.rescue;else for(e in c)d.name=e,w(a,b,c[e],d)}}function x(a,b,c){var a=a.cfg,d=a.domains,e="local",f=a.defaultPackage,g=b.toString();if(/^(?:(\w+):)?(?:(\w+)\.)?(\w+)$/.test(g))g=RegExp.$3,f=RegExp.$2||a.packages[g]||f,e=RegExp.$1||e;d[e]||(e="local");return{format:c||
d[e][0],domain:d[e][1],packageName:f,name:g,toString:function(){return e+":"+f+"."+g}}}function C(a,b,c){var a=a.cfg,d=b.packageName,e=b.name;if(c==h)c=a.mode;return b.domain+(c==j.modes.PROD?d:d==a.defaultPackage?e:d+"/"+e)+"."+b.format}function v(a,b,c){var a=a.cfg.processors,d=a[b];d||(d=a[b]=n(function(a){m(a)&&a()}));d.process(c)}function L(a,b){return function(){var c=arguments,d=x(a,b);v(a,"callComponent",[a,d,c])}}function D(a,b){var c={assets:b};return function(b){if(!c.impl){var e,f;m(b)?
(e=function(){b("success")},f=function(){b("error")}):e=f=function(){};u(a,c,e);c.rescue=f;c.impl()}}}var j={},i={},z="data-willjs-id",H=/^([\w\-\.]+?)(?:\.min|\-\d+(?:\.\d+)*(?:\w+)?)*\.(?:css|js)$/,E=Array.prototype.slice,G=Object.prototype.toString,F=false,r=s.document;s.will=j;k.call(i,{call:function(a){return L(this,a)},use:function(a){return D(this,p(a)?a:E.call(arguments,0))},addComponent:function(a,b){return w(this,this.registry,b,x(this,a))},addProcessor:function(a,b){this.cfg.processors[a]||
(this.cfg.processors[a]=n(b))},process:function(a){v(this,a,E.call(arguments,1))},modes:{DEV:0,PROD:1},"u.extend":k});k.call(j,{configure:function(a){t(this,false,a);return this},reconfigure:function(a){t(this,true,a);return this}});k.call(j,i);i.u.loadComponent=function(a,b,c){F?c(500,""):a.use("//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js")(function(d){d==="success"?(i.u.loadComponent=A,A(a,b,c)):(F=true,c(500,""))})};i.u.extend({pathFor:x,urlFor:C,implWrapper:u,newProcessor:n,getConfig:function(){return{cfg:k.call(new this.Defaults,
{processors:new this.Processors,domains:{local:["json","/javascripts/will/"]},packages:{}}),registry:{}}},Processors:function(){},Defaults:function(){}});(function(a){a.callComponent=n(function(a,c,d){var e=this,f=a.registry,g=C(a,c),k=B(f,c),i=k.impl;if(i)i.apply(h,d);else return c.format=="js"?(g=c.toString().replace(/[:\.]/g,"_")+"@"+g,D(a,[g])(function(a){try{if(a=="success")(i=k.impl)&&i.apply(h,d)}finally{e.sched()}})):j.u.loadComponent(a,g,function(g,j){try{if(g!==200)throw"could not load component: "+
c;j=eval("("+j+")");if(!l(j))w(a,f,j,c),(i=k.impl)&&i.apply(h,d)}finally{e.sched()}}),false});a.loadDependenciesAndCall=n(function(a,c,d){var e=this,a=a.cfg.debug,f=c.assets||c.libs,g;if(f.length)if(g=f[0],I(g))f.shift(),c.impl.apply(h,d);else return a&&a('** loading asset "'+g+'"'),K(g,function(a){try{a==="success"?(f.shift(),c.impl.apply(h,d)):c.rescue.apply(h,d)}finally{e.sched()}}),false;else c.impl.apply(h,d)})})(i.u.Processors.prototype);k.call(i.u.Defaults.prototype,{mode:j.modes.DEV,version:"1.0",
addDomain:function(a,b,c){this.domains[a]=[c?"js":"json",b+(/\/$/.test(b)?"":"/")]},defaultPackage:"root",registerPackage:function(a,b){var c=b.split(/,/),d,e,f;d=this.packages;for(f=0,e=c.length;f<e;)d[c[f++]]=a}});t(j,false)})(window,null);
